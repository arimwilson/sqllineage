<!DOCTYPE html>
<html lang="en" class="h-full bg-slate-950">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SQL Lineage Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#eef2ff",
                100: "#e0e7ff",
                200: "#c7d2fe",
                300: "#a5b4fc",
                400: "#818cf8",
                500: "#6366f1",
                600: "#4f46e5",
                700: "#4338ca",
                800: "#3730a3",
                900: "#312e81",
              },
            },
          },
        },
      };
    </script>
    <link rel="preconnect" href="https://rsms.me/" />
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />
    <script src="./graphology.min.js"></script>
    <script>
      const graph = new graphology.Graph();

      const { UndirectedGraph, DirectedGraph } = graphology;
    </script>
    <script src="https://unpkg.com/sigma@2.3.1/build/sigma.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/elkjs@0.9.3/lib/elk.bundled.js"></script>
  </head>
  <body class="min-h-full text-slate-100 font-sans">
    <div class="min-h-screen flex flex-col">
      <header class="bg-slate-900 border-b border-slate-800">
        <div
          class="max-w-7xl mx-auto px-6 py-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between"
        >
          <div>
            <h1 class="text-3xl font-semibold text-white">
              SQL Lineage Visualizer
            </h1>
            <p class="text-slate-400">
              Experiment with Vertica DDL statements and inspect lineage in
              seconds.
            </p>
          </div>
          <div class="flex items-center gap-3 text-sm text-slate-300">
            <span
              class="inline-flex items-center gap-2 bg-slate-800 border border-slate-700 rounded-full px-3 py-1"
            >
              <span
                class="w-2.5 h-2.5 bg-emerald-400 rounded-full animate-pulse"
              ></span>
              <span>Powered by /api/lineage</span>
            </span>
          </div>
        </div>
      </header>

      <main class="flex-1">
        <div class="max-w-7xl mx-auto px-6 py-10 space-y-10">
          <section class="grid lg:grid-cols-2 gap-8">
            <div class="space-y-8">
              <div
                class="bg-slate-900 border border-slate-800 rounded-3xl shadow-xl"
              >
                <div class="p-6 border-b border-slate-800">
                  <h2 class="text-xl font-semibold text-white">
                    1. Existing Tables
                  </h2>
                  <p class="text-sm text-slate-400 mt-1">
                    Provide a list of fully qualified table names that already
                    exist in the system.
                  </p>
                </div>
                <div class="p-6">
                  <textarea
                    id="existing-tables"
                    class="w-full h-36 rounded-2xl bg-slate-950 border border-slate-800 focus:border-primary-500 focus:ring-primary-500 px-4 py-3 text-sm"
                    placeholder="schema.table_one\nschema.table_two"
                  ></textarea>
                  <p class="text-xs text-slate-500 mt-2">
                    Enter one table per line. External resources like
                    <code class="text-primary-300">ext://s3://bucket</code> are
                    also supported.
                  </p>
                </div>
              </div>

              <div
                class="bg-slate-900 border border-slate-800 rounded-3xl shadow-xl"
              >
                <div
                  class="p-6 flex items-center justify-between border-b border-slate-800"
                >
                  <div>
                    <h2 class="text-xl font-semibold text-white">
                      2. Vertica DDL Statements
                    </h2>
                    <p class="text-sm text-slate-400 mt-1">
                      Statements execute in order. Toggle statements to include
                      or exclude them.
                    </p>
                  </div>
                  <button
                    id="add-statement"
                    class="inline-flex items-center gap-2 px-4 py-2 bg-primary-600 hover:bg-primary-500 transition-colors text-sm font-medium rounded-full"
                  >
                    <span class="text-lg leading-none">+</span>
                    <span>Add statement</span>
                  </button>
                </div>
                <div id="statements-container" class="p-6 space-y-4"></div>
              </div>

              <div
                class="bg-slate-900 border border-slate-800 rounded-3xl shadow-xl"
              >
                <div class="p-6 space-y-4">
                  <button
                    id="run-button"
                    class="w-full inline-flex justify-center items-center gap-3 px-6 py-3 text-sm font-medium rounded-full bg-primary-500 hover:bg-primary-400 transition-colors"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                      class="w-5 h-5"
                    >
                      <path
                        d="M3.172 16.172a4 4 0 010-5.657L10 3.686l6.828 6.829a4 4 0 01-5.657 5.657L10 14.343l-1.172 1.172a4 4 0 01-5.656 0z"
                      />
                    </svg>
                    Analyze lineage
                  </button>
                  <p class="text-xs text-slate-500 leading-relaxed">
                    The request is POSTed to
                    <code class="text-primary-300">/api/lineage</code>. Disable
                    statements to test the effect of skipping certain
                    operations.
                  </p>
                  <div
                    id="request-status"
                    class="text-sm text-slate-400 hidden"
                  ></div>
                </div>
              </div>
            </div>

            <div class="space-y-8">
              <div
                class="bg-slate-900 border border-slate-800 rounded-3xl shadow-xl overflow-hidden"
              >
                <div class="p-6 border-b border-slate-800">
                  <h2 class="text-xl font-semibold text-white">
                    3. Lineage Graph
                  </h2>
                  <p class="text-sm text-slate-400 mt-1">
                    We automatically arrange the lineage graph with ELK and
                    render it with Sigma.js.
                  </p>
                </div>
                <div class="h-[420px] bg-slate-950" id="graph-container">
                  <div
                    class="h-full flex items-center justify-center text-slate-500 text-sm"
                    id="graph-placeholder"
                  >
                    Run the analyzer to see lineage.
                  </div>
                </div>
              </div>

              <div
                class="bg-slate-900 border border-slate-800 rounded-3xl shadow-xl"
              >
                <div class="p-6 border-b border-slate-800">
                  <h2 class="text-xl font-semibold text-white">
                    4. Response Details
                  </h2>
                  <p class="text-sm text-slate-400 mt-1">
                    Inspect detailed edges, warnings, and ephemeral/live table
                    sets.
                  </p>
                </div>
                <div class="p-6 space-y-6 text-sm">
                  <div>
                    <h3 class="uppercase tracking-wide text-xs text-slate-500">
                      Live Tables
                    </h3>
                    <ul id="live-tables" class="mt-2 space-y-1"></ul>
                  </div>
                  <div>
                    <h3 class="uppercase tracking-wide text-xs text-slate-500">
                      Ephemeral Tables
                    </h3>
                    <ul id="ephemeral-tables" class="mt-2 space-y-1"></ul>
                  </div>
                  <div>
                    <h3 class="uppercase tracking-wide text-xs text-slate-500">
                      Detailed Edges
                    </h3>
                    <div class="overflow-x-auto">
                      <table
                        class="min-w-full divide-y divide-slate-800 text-left"
                      >
                        <thead class="text-xs uppercase text-slate-500">
                          <tr>
                            <th class="py-2 pr-4">Source</th>
                            <th class="py-2 pr-4">Operation</th>
                            <th class="py-2 pr-4">Target</th>
                            <th class="py-2">Statement #</th>
                          </tr>
                        </thead>
                        <tbody
                          id="edges-table"
                          class="divide-y divide-slate-800"
                        ></tbody>
                      </table>
                    </div>
                  </div>
                  <div>
                    <h3 class="uppercase tracking-wide text-xs text-slate-500">
                      Warnings
                    </h3>
                    <ul id="warnings" class="mt-2 space-y-2"></ul>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </main>

      <footer class="bg-slate-900 border-t border-slate-800">
        <div
          class="max-w-7xl mx-auto px-6 py-6 text-xs text-slate-500 flex justify-between"
        >
          <span>Built with ❤️ using Tailwind CSS &amp; Sigma.js</span>
          <a
            href="https://sigmajs.org"
            target="_blank"
            class="text-primary-300 hover:text-primary-200"
            >Sigma.js</a
          >
        </div>
      </footer>
    </div>

    <template id="statement-template">
      <div
        class="statement-card bg-slate-950 border border-slate-800 rounded-2xl p-5 space-y-4"
      >
        <div class="flex items-center justify-between gap-3">
          <div class="flex items-center gap-3">
            <span
              class="statement-index w-8 h-8 rounded-full bg-primary-500/20 text-primary-200 flex items-center justify-center font-semibold"
            ></span>
            <label
              class="inline-flex items-center gap-2 text-sm text-slate-300"
            >
              <input
                type="checkbox"
                class="statement-enabled rounded border-slate-700 text-primary-500 focus:ring-primary-500"
                checked
              />
              Enabled
            </label>
          </div>
          <button
            class="remove-statement text-xs text-slate-500 hover:text-red-400 transition-colors"
          >
            Remove
          </button>
        </div>
        <textarea
          class="statement-sql w-full min-h-[140px] rounded-2xl bg-slate-900 border border-slate-800 focus:border-primary-500 focus:ring-primary-500 px-4 py-3 text-sm"
          placeholder="CREATE TABLE ...;"
        ></textarea>
      </div>
    </template>

    <script src="./main.js" type="module"></script>
  </body>
</html>
